// This isyourPrismaschemafile,
//learnmoreaboutitinthedocs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = env("DATABASE_URL")
}

// 分类表（支持1-3级树形结构）
model Category {
  id        String     @id @default(cuid())
  name      String     // 分类名称
  level     Int        // 层级: 1/2/3
  parentId  String?    // 父分类ID（一级分类为null）
  order     Int        @default(0) // 同级排序序号
  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
  
  // 自引用关系：构建树形结构
  parent   Category?  @relation("CategoryTree", fields: [parentId], references: [id], onDelete: Cascade)
  children Category[] @relation("CategoryTree")
  
  // 关联的货品
  products Product[]
  
  @@index([parentId])
  @@index([level])
}

// 货品表
model Product {
  id           String         @id @default(cuid())
  code         String         @unique // 货品编码(如B98, B95)
  name         String         // 货品名称
  category     String         @default("其他") // 品类(保留向后兼容)
  categoryId   String?        // 关联分类表ID
  spec         String?        // 规格(可选)
  images       String?        // 图片路径(JSON字符串数组)
  remark       String?        // 备注
  currentStock Int            @default(0) // 当前库存
  minOrderQty  Int            @default(0) // 最小起订量
  channel      String?        // 采购渠道说明
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  
  // 关联
  categoryRef   Category?      @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  purchaseItems PurchaseItem[]
  
  @@index([categoryId])
}

// 供应商表
model Supplier {
  id          String     @id @default(cuid())
  name        String     // 供应商名称
  contactName String?    // 主要联系人
  phone       String?    // 联系电话
  address     String?    // 经营地址
  type        String     @default("其他") // 渠道类型: 1688/拼多多/微信群/公司帮进/推微信进
  remark      String?    // 备注
  createdAt   DateTime   @default(now())
  updatedAt   DateTime   @updatedAt
  
  // 关联
  purchases Purchase[]
}

// 进货单表
model Purchase {
  id           String         @id @default(cuid())
  orderNo      String         @unique // 进货单号(自动生成)
  supplierId   String         // 供应商ID
  purchaseDate DateTime       // 进货日期
  totalAmount  Float          // 总金额
  shippingFee  Float          @default(0) // 运费
  remark       String?        // 备注
  photos       String?        // 照片路径(JSON数组)
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  
  // 关联
  supplier Supplier       @relation(fields: [supplierId], references: [id])
  items    PurchaseItem[]
}

// 进货明细表
model PurchaseItem {
  id         String   @id @default(cuid())
  purchaseId String   // 进货单ID
  productId  String   // 货品ID
  quantity   Int      // 数量
  unitPrice  Float    // 单价
  subtotal   Float    // 小计
  createdAt  DateTime @default(now())
  
  // 关联
  purchase Purchase @relation(fields: [purchaseId], references: [id], onDelete: Cascade)
  product  Product  @relation(fields: [productId], references: [id])
}

// 用户表
model User {
  id        String   @id @default(cuid())
  username  String   @unique
  password  String   // 哈希后的密码
  role      String   @default("user") // user/admin
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}